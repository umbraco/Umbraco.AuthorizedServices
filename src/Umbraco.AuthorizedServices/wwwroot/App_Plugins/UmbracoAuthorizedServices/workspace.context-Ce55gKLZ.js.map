{"version":3,"file":"workspace.context-Ce55gKLZ.js","sources":["../../../Client/src/workspace/workspace.context-token.ts","../../../Client/src/workspace/workspace.element.ts","../../../Client/src/workspace/workspace.context.ts"],"sourcesContent":["import { UmbContextToken } from \"@umbraco-cms/backoffice/context-api\";\r\nimport type { UmbWorkspaceContext } from \"@umbraco-cms/backoffice/workspace\";\r\nimport { AUTHORIZED_SERVICE_ENTITY_TYPE } from \"@umbraco-authorizedservices/entities\";\r\nimport type { AuthorizedServiceWorkspaceContext } from \"./workspace.context.js\";\r\n\r\nexport const AUTHORIZED_SERVICES_WORKSPACE_CONTEXT_ALIAS = \"AuthorizedServicesWorkspaceContext\";\r\n\r\nexport const AUTHORIZED_SERVICES_WORKSPACE_CONTEXT = new UmbContextToken<\r\n  UmbWorkspaceContext,\r\n  AuthorizedServiceWorkspaceContext\r\n>(\r\n  AUTHORIZED_SERVICES_WORKSPACE_CONTEXT_ALIAS,\r\n  undefined,\r\n  (context): context is AuthorizedServiceWorkspaceContext =>\r\n    context.getEntityType?.() === AUTHORIZED_SERVICE_ENTITY_TYPE,\r\n);\r\n","import { UmbElementMixin } from \"@umbraco-cms/backoffice/element-api\";\r\nimport { LitElement, customElement, html, css, state, when } from \"@umbraco-cms/backoffice/external/lit\";\r\nimport { ServiceService, type AuthorizedServiceDisplay } from \"@umbraco-authorizedservices/generated\";\r\nimport { tryExecute, tryExecuteAndNotify } from \"@umbraco-cms/backoffice/resources\";\r\nimport { UMB_NOTIFICATION_CONTEXT } from \"@umbraco-cms/backoffice/notification\";\r\nimport { AUTHORIZED_SERVICES_WORKSPACE_CONTEXT } from \"./workspace.context-token.js\";\r\n\r\nconst elementName = \"authorized-service-workspace\";\r\n\r\nenum AuthenticationMethod {\r\n  None = \"None\",\r\n  OAuth1 = \"OAuth1\",\r\n  OAuth2AuthorizationCode = \"OAuth2AuthorizationCode\",\r\n  OAuth2ClientCredentials = \"OAuth2ClientCredentials\",\r\n  ApiKey = \"ApiKey\"\r\n}\r\n\r\n@customElement(elementName)\r\nexport class AuthorizedServiceWorkspaceEditorElement extends UmbElementMixin(LitElement) {\r\n\r\n  #workspaceContext?: typeof AUTHORIZED_SERVICES_WORKSPACE_CONTEXT.TYPE;\r\n  #notificationContext?: typeof UMB_NOTIFICATION_CONTEXT.TYPE;\r\n\r\n  @state()\r\n  private _service?: AuthorizedServiceDisplay;\r\n\r\n  @state()\r\n  private _authenticationMethod = AuthenticationMethod.None;\r\n\r\n  @state()\r\n  private _sampleRequestResponse?: string = undefined;\r\n\r\n  constructor() {\r\n    super();\r\n\r\n    this.consumeContext(AUTHORIZED_SERVICES_WORKSPACE_CONTEXT, (context) => {\r\n      this.#workspaceContext = context;\r\n\t\t\tthis.#observeService();\r\n\t\t});\r\n\r\n    this.consumeContext(UMB_NOTIFICATION_CONTEXT, (instance) => {\r\n      this.#notificationContext = instance;\r\n    });\r\n\t}\r\n\r\n\t#observeService() {\r\n\t\tif (!this.#workspaceContext) return;\r\n\t\tthis.observe(this.#workspaceContext.data, (data) => {\r\n      if (!data) return;\r\n\r\n      this._service = data;\r\n      this._authenticationMethod = data.authenticationMethod as AuthenticationMethod;\r\n    });\r\n\t}\r\n\r\n  #isOAuth1 = () => this._authenticationMethod === AuthenticationMethod.OAuth1;\r\n  #isOAuth2AuthorizationCode = () => this._authenticationMethod === AuthenticationMethod.OAuth2AuthorizationCode;\r\n  #isOAuth2ClientCredentials = () => this._authenticationMethod === AuthenticationMethod.OAuth2ClientCredentials;\r\n  #isApiKey = () => this._authenticationMethod === AuthenticationMethod.ApiKey;\r\n\r\n  async #authorizeAccess() {\r\n    if (this.#isOAuth2ClientCredentials()) {\r\n      const { data } = await tryExecuteAndNotify(\r\n        this,\r\n        ServiceService.generateOauth2ClientCredentialsToken({requestBody: {\r\n          alias: this._service!.alias\r\n        }})\r\n      );\r\n\r\n      if (data) {\r\n        this.#notificationContext?.peek(\"positive\", {\r\n          data: { message: `The '${this._service!.displayName}' service has been authorized.` },\r\n        });\r\n\r\n        this.#refreshServiceDetails();\r\n      }\r\n    } else if (this.#isOAuth1()) {\r\n      const { data } = await tryExecuteAndNotify(\r\n        this,\r\n        ServiceService.generateOauth1RequestToken({requestBody: {\r\n          alias: this._service!.alias\r\n        }})\r\n      );\r\n\r\n      if (data) {\r\n        location.href = data;\r\n      }\r\n    } else {\r\n      location.href = this._service!.authorizationUrl ?? \"\";\r\n    }\r\n  }\r\n\r\n  async #revokeAccess() {\r\n\t\tawait tryExecuteAndNotify(\r\n\t\t\tthis,\r\n\t\t\tServiceService.revokeAccess({requestBody: {\r\n        alias: this._service!.alias\r\n      }})\r\n\t\t);\r\n\r\n    this.#refreshServiceDetails();\r\n  }\r\n\r\n  async #saveOAuth1AccessToken() {\r\n    const accessTokenInputElement = <HTMLInputElement>this.shadowRoot?.getElementById(\"inAccessToken\");\r\n    const tokenSecretInputElement = <HTMLInputElement>this.shadowRoot?.getElementById(\"inTokenSecret\");\r\n    if (!accessTokenInputElement || !tokenSecretInputElement) return;\r\n\r\n\t\tconst { error } = await tryExecuteAndNotify(\r\n\t\t\tthis,\r\n\t\t\tServiceService.saveOauth1Token({requestBody: {\r\n        alias: this._service!.alias,\r\n        token: accessTokenInputElement.value,\r\n        tokenSecret: tokenSecretInputElement.value\r\n      }})\r\n\t\t);\r\n\r\n    if (!error) {\r\n      this.#notificationContext?.peek(\"positive\", {\r\n        data: { message: `The '${this._service!.displayName}' service access token and token secret have been saved.` },\r\n      });\r\n      accessTokenInputElement.value = \"\";\r\n      this.#refreshServiceDetails();\r\n    }\r\n  }\r\n\r\n  async #saveOAuth2AccessToken() {\r\n    const accessTokenInputElement = <HTMLInputElement>this.shadowRoot?.getElementById(\"inAccessToken\");\r\n    if (!accessTokenInputElement) return;\r\n\r\n\t\tconst { error } = await tryExecuteAndNotify(\r\n\t\t\tthis,\r\n\t\t\tServiceService.saveOauth2Token({requestBody: {\r\n        alias: this._service!.alias,\r\n        token: accessTokenInputElement.value\r\n      }})\r\n\t\t);\r\n\r\n    if (!error) {\r\n      this.#notificationContext?.peek(\"positive\", {\r\n        data: { message: `The '${this._service!.displayName}' service access token has been saved.` },\r\n      });\r\n      accessTokenInputElement.value = \"\";\r\n      this.#refreshServiceDetails();\r\n    }\r\n  }\r\n\r\n  async #saveApiKey() {\r\n    const apiKeyInputElement = <HTMLInputElement>this.shadowRoot?.getElementById(\"inApiKey\");\r\n    if (!apiKeyInputElement) return;\r\n\r\n\t\tconst { error } = await tryExecuteAndNotify(\r\n\t\t\tthis,\r\n\t\t\tServiceService.saveApiKey({requestBody: {\r\n        alias: this._service!.alias,\r\n        apiKey: apiKeyInputElement.value\r\n      }})\r\n\t\t);\r\n\r\n    if (!error) {\r\n      this.#notificationContext?.peek(\"positive\", {\r\n        data: { message: `The '${this._service!.displayName}' service API key has been saved.` },\r\n      });\r\n      apiKeyInputElement.value = \"\";\r\n      this.#refreshServiceDetails();\r\n    }\r\n  }\r\n\r\n  #refreshServiceDetails() {\r\n    // Reload the service data to get the updated status.\r\n    this.#workspaceContext?.load(this._service!.alias);\r\n  }\r\n\r\n  async #sendSampleRequest() {\r\n    this._sampleRequestResponse = undefined;\r\n\r\n\t\tconst { data, error } = await tryExecute(\r\n\t\t\tServiceService.sendSampleRequest({\r\n        alias: this._service!.alias\r\n      })\r\n\t\t);\r\n\r\n    if (!data || error) {\r\n      this.#notificationContext?.peek(\"danger\", {\r\n        data: { message: \"The sample request did not complete: \" + error?.message },\r\n      });\r\n    }\r\n    else {\r\n      this._sampleRequestResponse = \"Request: \" + this._service!.sampleRequest + \"\\r\\nResponse: \" + JSON.stringify(data, null, 2);\r\n    }\r\n  }\r\n\r\n  render() {\r\n    return html`\r\n      ${when(this._service,\r\n        () => html`\r\n          <umb-workspace-editor headline=\"Authorized Services: ${this._service!.displayName}\" alias=\"AuthorizedServices.Workspace\">\r\n            <umb-body-layout header-transparent header-fit-height>\r\n                ${this.#renderStatusSection(this._service!)}\r\n                ${when(this._service!.canManuallyProvideToken && this.#isOAuth1(),\r\n                  () => this.#renderOAuth1TokenSection()\r\n                )}\r\n                ${when(this._service!.canManuallyProvideToken && (this.#isOAuth2AuthorizationCode() || this.#isOAuth2ClientCredentials()),\r\n                  () => this.#renderOAuth2TokenSection()\r\n                )}\r\n                ${when(this._service!.canManuallyProvideApiKey && this.#isApiKey(),\r\n                  () => this.#renderKeySection()\r\n                )}\r\n                ${this.#renderSettingsSection(this._service!)}\r\n              </umb-body-layout>\r\n          </umb-workspace-editor>\r\n        `)}\r\n    `;\r\n  }\r\n\r\n  #renderStatusSection(service: AuthorizedServiceDisplay) {\r\n    return html`\r\n      <uui-box headline=\"Status\">\r\n        <uui-tag size=\"s\" slot=\"header-actions\" color=\"${service.isAuthorized ? \"positive\" : \"danger\"}\">\r\n          ${service.isAuthorized ? \"Authorized\" : \"Not Authorized\"}\r\n        </uui-tag>        \r\n        <p><b>${service.displayName}</b> has been configured as an authorized service.</p>\r\n        ${when(service.isAuthorized,\r\n          () => html`\r\n            <div>\r\n              ${when(service.sampleRequest,\r\n                () => html`\r\n                  <uui-button\r\n                    label=\"Verify Sample Request\"\r\n                    look=\"outline\"\r\n                    @click=${this.#sendSampleRequest}></uui-button>\r\n                `)}\r\n              ${when(this.#isOAuth1() || this.#isOAuth2AuthorizationCode() || this.#isOAuth2ClientCredentials(),\r\n                () => html`\r\n                  <uui-button\r\n                    label=\"Revoke Access\"\r\n                    look=\"primary\"\r\n                    color=\"danger\"\r\n                    @click=${this.#revokeAccess}></uui-button>\r\n                `)}\r\n\r\n              ${when(this._sampleRequestResponse,\r\n                () => html`\r\n                    <div id=\"sample-response\">\r\n                      <div>${this._sampleRequestResponse}</div>\r\n                    </div>`\r\n                )}\r\n            </div>\r\n          `)}\r\n\r\n        ${when(!service.isAuthorized && !this.#isApiKey(),\r\n          () => html`\r\n            <div>\r\n              <p>To authorize the service click to sign-in to the provider's portal, confirm the permission request and return to Umbraco.</p>\r\n              <uui-button\r\n                label=\"Authorize Service\"\r\n                look=\"primary\"\r\n                color=\"positive\"\r\n                @click=${this.#authorizeAccess}></uui-button>\r\n            </div>\r\n          `)}\r\n\r\n      </uui-box>\r\n      `;\r\n  }\r\n\r\n  #renderOAuth1TokenSection() {\r\n    return html`\r\n       <uui-box headline=\"Provide OAuth1 Access Token and Token Secret\">\r\n          <p>Enter service access token and token secret</p>\r\n          <p>This service is configured indicating that an access token and a token secret can be generated via the service's developer portal. Once you have obtained them you can copy and paste them here to authorize the service.</p>\r\n          <div>\r\n            <uui-form>\r\n              <uui-form-layout-item class=\"form-item\">\r\n                <uui-label for=\"inAccessToken\" slot=\"label\">Access Token</uui-label>\r\n                <uui-input id=\"inAccessToken\" name=\"access_token\" type=\"text\" label=\"Access Token\"></uui-input>\r\n              </uui-form-layout-item>\r\n              <uui-form-layout-item class=\"form-item\">\r\n                <uui-label for=\"inTokenSecret\" slot=\"label\">Token Secret</uui-label>\r\n                <uui-input id=\"inTokenSecret\" name=\"token_secret\" type=\"text\" label=\"Token Secret\"></uui-input>\r\n              </uui-form-layout-item>\r\n              <div>\r\n                <uui-button\r\n                  label=\"Save\"\r\n                  look=\"primary\"\r\n                  color=\"positive\"\r\n                  @click=${this.#saveOAuth1AccessToken}></uui-button>\r\n              </div>\r\n            </uui-form>\r\n          </div>\r\n       </uui-box>\r\n    `;\r\n  }\r\n\r\n  #renderOAuth2TokenSection() {\r\n    return html`\r\n      <uui-box headline=\"Provide Token\">\r\n        <p>Enter service access token</p>\r\n        <p>This service is configured indicating that a token can be generated via the service's developer portal. Once you have obtained one you can copy and paste it here to authorize the service.</p>\r\n        <div>\r\n          <uui-form>\r\n            <uui-form-layout-item class=\"form-item\">\r\n              <uui-label for=\"inAccessToken\" slot=\"label\">Access Token</uui-label>\r\n              <uui-input id=\"inAccessToken\" name=\"access_token\" type=\"text\" label=\"Access Token\"></uui-input>\r\n            </uui-form-layout-item>\r\n            <div>\r\n              <uui-button\r\n                label=\"Save\"\r\n                look=\"primary\"\r\n                color=\"positive\"\r\n                @click=${this.#saveOAuth2AccessToken}></uui-button>\r\n            </div>\r\n          </uui-form>\r\n        </div>\r\n      </uui-box>\r\n    `;\r\n  }\r\n\r\n  #renderKeySection() {\r\n    return html`\r\n      <uui-box headline=\"Provide API Key\">\r\n        <p>Enter service API key</p>\r\n        <p>\r\n          This service is configured indicating that an API key can be created via the service's developer portal.\r\n          Once you have obtained one you can copy and paste it here to authorize the service.\r\n        </p>\r\n        <div>\r\n          <uui-form>\r\n            <uui-form-layout-item class=\"form-item\">\r\n              <uui-label for=\"inApiKey\" slot=\"label\">Api Key</uui-label>\r\n              <uui-input id=\"inApiKey\" name=\"api_key\" type=\"text\" label=\"Api Key\"></uui-input>\r\n            </uui-form-layout-item>\r\n            <div>\r\n              <uui-button\r\n                label=\"Save\"\r\n                look=\"primary\"\r\n                color=\"positive\"\r\n                @click=${this.#saveApiKey}></uui-button>\r\n            </div>\r\n          </uui-form>\r\n        </div>\r\n      </uui-box>\r\n    `;\r\n  }\r\n\r\n  #renderSettingsSection(service: AuthorizedServiceDisplay) {\r\n    return html`\r\n      <uui-box headline=\"Settings\">\r\n        <uui-table>\r\n          <uui-table-head>\r\n            <uui-table-head-cell>Key</uui-table-head-cell>\r\n            <uui-table-head-cell>Value</uui-table-head-cell>\r\n          </uui-table-head>\r\n          ${Object.entries(service.settings).map(([key, value]) =>\r\n            html`<uui-table-row>\r\n              <uui-table-cell>${key}</uui-table-cell>\r\n              <uui-table-cell>${value}</uui-table-cell>\r\n            </uui-table-row>`)}\r\n        </uui-table>\r\n      </uui-box>\r\n    `;\r\n  }\r\n\r\n  static styles = [\r\n    css`\r\n      uui-box + uui-box {\r\n        margin-top: var(--uui-size-8);\r\n      }\r\n\r\n      #sample-response {\r\n        background: var(--uui-color-disabled);\r\n        border-radius: var(--uui-border-radius);\r\n        border: 2px solid var(--uui-color-default);\r\n        margin-top: var(--uui-size-8);\r\n      }\r\n\r\n      #sample-response div {\r\n        font-family: Consolas, Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif;\r\n        font-size: 12px;\r\n        min-height: 48px;\r\n        max-height: 512px;\r\n        overflow: auto;\r\n        white-space: pre;\r\n        padding: var(--uui-size-3) var(--uui-size-7);\r\n      }\r\n\r\n      .form-item uui-input {\r\n          width: 40%;\r\n      }\r\n    `\r\n  ];\r\n\r\n}\r\n\r\nexport default AuthorizedServiceWorkspaceEditorElement;\r\n\r\ndeclare global {\r\n  interface HTMLElementTagNameMap {\r\n    [elementName]: AuthorizedServiceWorkspaceEditorElement\r\n  }\r\n}\r\n","import { UmbWorkspaceRouteManager, type UmbWorkspaceContext } from \"@umbraco-cms/backoffice/workspace\";\r\nimport type { UmbControllerHostElement } from \"@umbraco-cms/backoffice/controller-api\";\r\nimport { UmbObjectState } from \"@umbraco-cms/backoffice/observable-api\";\r\nimport { tryExecuteAndNotify } from '@umbraco-cms/backoffice/resources';\r\nimport { UmbContextBase } from \"@umbraco-cms/backoffice/class-api\";\r\nimport { AUTHORIZED_SERVICE_ENTITY_TYPE } from \"@umbraco-authorizedservices/entities\";\r\nimport { type AuthorizedServiceDisplay, ServiceService } from \"@umbraco-authorizedservices/generated\";\r\nimport { WORKSPACE_ALIAS } from \"./manifests.js\";\r\nimport { AuthorizedServiceWorkspaceEditorElement } from \"./workspace.element.js\";\r\nimport { AUTHORIZED_SERVICES_WORKSPACE_CONTEXT } from \"./workspace.context-token.js\";\r\n\r\nexport class AuthorizedServiceWorkspaceContext\r\n  extends UmbContextBase<AuthorizedServiceDisplay>\r\n  implements UmbWorkspaceContext\r\n{\r\n  #data = new UmbObjectState<AuthorizedServiceDisplay | undefined>(undefined);\r\n\r\n  readonly data = this.#data.asObservable();\r\n  readonly alias = this.#data.asObservablePart((data) => data?.alias);\r\n  readonly name = this.#data.asObservablePart((data) => data?.displayName);\r\n\r\n  readonly workspaceAlias: string;\r\n  readonly routes: UmbWorkspaceRouteManager;\r\n\r\n  constructor(host: UmbControllerHostElement) {\r\n    super(host, WORKSPACE_ALIAS);\r\n    this.provideContext(AUTHORIZED_SERVICES_WORKSPACE_CONTEXT, this);\r\n\r\n    this.workspaceAlias = WORKSPACE_ALIAS;\r\n    this.routes = new UmbWorkspaceRouteManager(host);\r\n\r\n    this.routes.setRoutes([\r\n      {\r\n        path: \"edit/:alias\",\r\n        component: AuthorizedServiceWorkspaceEditorElement,\r\n        setup: (_component, info) => {\r\n          const alias = info.match.params.alias;\r\n          this.load(alias);\r\n        },\r\n      },\r\n    ]);\r\n  }\r\n\r\n  async load(alias: string) {\r\n\r\n\t\tconst { data } = await tryExecuteAndNotify(\r\n\t\t\tthis,\r\n\t\t\tServiceService.getByAlias({alias})\r\n\t\t);\r\n\r\n    if (data) {\r\n      this.#data.update(data);\r\n    }\r\n  }\r\n\r\n  getData() {\r\n    return this.#data.getValue();\r\n  }\r\n\r\n  getEntityType(): string {\r\n    return AUTHORIZED_SERVICE_ENTITY_TYPE;\r\n  }\r\n\r\n  getName() {\r\n    return this.#data.getValue()?.displayName;\r\n  }\r\n\r\n  destroy() {\r\n    this.#data.destroy();\r\n  }\r\n}\r\n\r\nexport { AuthorizedServiceWorkspaceContext as api };\r\n"],"names":["AUTHORIZED_SERVICES_WORKSPACE_CONTEXT_ALIAS","AUTHORIZED_SERVICES_WORKSPACE_CONTEXT","UmbContextToken","context","_a","AUTHORIZED_SERVICE_ENTITY_TYPE","_workspaceContext","_notificationContext","_AuthorizedServiceWorkspaceEditorElement_instances","observeService_fn","_isOAuth1","_isOAuth2AuthorizationCode","_isOAuth2ClientCredentials","_isApiKey","authorizeAccess_fn","revokeAccess_fn","saveOAuth1AccessToken_fn","saveOAuth2AccessToken_fn","saveApiKey_fn","refreshServiceDetails_fn","sendSampleRequest_fn","renderStatusSection_fn","renderOAuth1TokenSection_fn","renderOAuth2TokenSection_fn","renderKeySection_fn","renderSettingsSection_fn","elementName","AuthorizedServiceWorkspaceEditorElement","UmbElementMixin","LitElement","__privateAdd","__privateSet","__privateMethod","UMB_NOTIFICATION_CONTEXT","instance","html","when","__privateGet","data","tryExecuteAndNotify","ServiceService","accessTokenInputElement","tokenSecretInputElement","_b","error","_c","apiKeyInputElement","tryExecute","service","key","value","css","__decorateClass","state","customElement","AuthorizedServiceWorkspaceContext","UmbContextBase","host","WORKSPACE_ALIAS","_data","UmbObjectState","UmbWorkspaceRouteManager","_component","info","alias"],"mappings":";;;;;;;;;;;;;;AAKO,MAAMA,KAA8C,sCAE9CC,IAAwC,IAAIC;AAAA,EAIvDF;AAAA,EACA;AAAA,EACA,CAACG,MACC;;AAAA,aAAAC,IAAAD,EAAQ,kBAAR,gBAAAC,EAAA,KAAAD,QAA8BE;AAAA;AAClC;;;;;;;wYCfAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC,GAAAC;AAOA,MAAMC,KAAc;AAWb,IAAMC,IAAN,cAAsDC,EAAgBC,EAAU,EAAE;AAAA,EAcvF,cAAc;AACN,aAfHC,EAAA,MAAAtB,CAAA,GAELsB,EAAA,MAAAxB,CAAA,GACAwB,EAAA,MAAAvB,CAAA,GAMA,KAAQ,wBAAwB,QAGhC,KAAQ,yBAAkC,QAyB9BuB;AAAA,MAAA;AAAA,MAAApB;AAAA,MAAA,MAAM,KAAK,0BAA0B;AAAA;AAAA,OACpBoB;AAAA,MAAA;AAAA,MAAAnB;AAAA,MAAA,MAAM,KAAK,0BAA0B;AAAA;AAAA,OACrCmB;AAAA,MAAA;AAAA,MAAAlB;AAAA,MAAA,MAAM,KAAK,0BAA0B;AAAA;AAAA,OACtDkB;AAAA,MAAA;AAAA,MAAAjB;AAAA,MAAA,MAAM,KAAK,0BAA0B;AAAA;AAAA,OAvB1C,KAAA,eAAeZ,GAAuC,CAACE,MAAY;AACtE,MAAA4B,EAAA,MAAKzB,GAAoBH,CAAA,GAC5B6B,EAAA,MAAKxB,GAALC,CAAA,EAAA,KAAA,IAAA;AAAA,IAAA,CACA,GAEM,KAAA,eAAewB,IAA0B,CAACC,MAAa;AAC1D,MAAAH,EAAA,MAAKxB,GAAuB2B,CAAA;AAAA,IAAA,CAC7B;AAAA,EACJ;AAAA,EAqJC,SAAS;AACA,WAAAC;AAAA,QACHC;AAAA,MAAK,KAAK;AAAA,MACV,MAAMD;AAAA,iEACmD,KAAK,SAAU,WAAW;AAAA;AAAA,kBAEzEH,EAAK,MAAAxB,GAAAa,CAAA,EAAL,KAA0B,MAAA,KAAK,QAAU,CAAA;AAAA,kBACzCe;AAAA,QAAK,KAAK,SAAU,2BAA2BC,EAAA,MAAK3B,CAAL,EAAA,KAAA,IAAA;AAAA,QAC/C,MAAMsB,QAAKxB,GAALc,CAAA,EAAA,KAAA,IAAA;AAAA,MAAA,CACP;AAAA,kBACCc;AAAA,QAAK,KAAK,SAAU,4BAA4BC,QAAK1B,CAAL,EAAA,KAAA,IAAA,KAAqC0B,QAAKzB,CAAL,EAAA,KAAA,IAAA;AAAA,QACrF,MAAMoB,QAAKxB,GAALe,CAAA,EAAA,KAAA,IAAA;AAAA,MAAA,CACP;AAAA,kBACCa;AAAA,QAAK,KAAK,SAAU,4BAA4BC,EAAA,MAAKxB,CAAL,EAAA,KAAA,IAAA;AAAA,QAChD,MAAMmB,QAAKxB,GAALgB,CAAA,EAAA,KAAA,IAAA;AAAA,MAAA,CACP;AAAA,kBACCQ,EAAK,MAAAxB,GAAAiB,CAAA,EAAL,KAA4B,MAAA,KAAK,QAAU,CAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAGnD;AAAA;AAAA,EAER;AAmLF;AApXEnB,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAHKC,IAAA,oBAAA,QAAA;AA2BNC,IAAe,WAAG;AACb,EAAC4B,QAAK/B,CAAmB,KAC7B,KAAK,QAAQ+B,EAAA,MAAK/B,CAAkB,EAAA,MAAM,CAACgC,MAAS;AAChD,IAAKA,MAEL,KAAK,WAAWA,GAChB,KAAK,wBAAwBA,EAAK;AAAA,EAAA,CACnC;AACJ;AAEC5B,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AACAC,IAAA,oBAAA,QAAA;AAEMC,IAAgB,iBAAG;;AACnB,MAAAuB,EAAA,MAAKzB,GAAL,KAAmC,IAAA,GAAA;AAC/B,UAAA,EAAE,MAAA0B,EAAK,IAAI,MAAMC;AAAA,MACrB;AAAA,MACAC,EAAe,qCAAqC,EAAC,aAAa;AAAA,QAChE,OAAO,KAAK,SAAU;AAAA,MAAA,GACtB;AAAA,IAAA;AAGJ,IAAIF,OACGlC,IAAAiC,EAAA,MAAA9B,CAAA,MAAA,QAAAH,EAAsB,KAAK,YAAY;AAAA,MAC1C,MAAM,EAAE,SAAS,QAAQ,KAAK,SAAU,WAAW,iCAAiC;AAAA,IAAA,IAGtF4B,EAAA,MAAKxB,GAALW,CAAA,EAAA,KAAA,IAAA;AAAA,EACF,WACSkB,EAAK,MAAA3B,CAAA,EAAL,KAAkB,IAAA,GAAA;AACrB,UAAA,EAAE,MAAA4B,EAAK,IAAI,MAAMC;AAAA,MACrB;AAAA,MACAC,EAAe,2BAA2B,EAAC,aAAa;AAAA,QACtD,OAAO,KAAK,SAAU;AAAA,MAAA,GACtB;AAAA,IAAA;AAGJ,IAAIF,MACF,SAAS,OAAOA;AAAA,EAClB;AAES,aAAA,OAAO,KAAK,SAAU,oBAAoB;AAEvD;AAEMvB,IAAa,iBAAG;AAChB,QAAAwB;AAAA,IACL;AAAA,IACAC,EAAe,aAAa,EAAC,aAAa;AAAA,MACrC,OAAO,KAAK,SAAU;AAAA,IAAA,GACtB;AAAA,EAAA,GAGJR,EAAA,MAAKxB,GAALW,CAAA,EAAA,KAAA,IAAA;AACF;AAEMH,IAAsB,iBAAG;;AAC7B,QAAMyB,KAA4CrC,IAAA,KAAK,eAAL,gBAAAA,EAAiB,eAAe,kBAC5EsC,KAA4CC,IAAA,KAAK,eAAL,gBAAAA,EAAiB,eAAe;AAC9E,MAAA,CAACF,KAA2B,CAACC,EAAyB;AAEtD,QAAA,EAAE,OAAAE,EAAM,IAAI,MAAML;AAAA,IACvB;AAAA,IACAC,EAAe,gBAAgB,EAAC,aAAa;AAAA,MACxC,OAAO,KAAK,SAAU;AAAA,MACtB,OAAOC,EAAwB;AAAA,MAC/B,aAAaC,EAAwB;AAAA,IAAA,GACrC;AAAA,EAAA;AAGJ,EAAKE,OACEC,IAAAR,EAAA,MAAA9B,CAAA,MAAA,QAAAsC,EAAsB,KAAK,YAAY;AAAA,IAC1C,MAAM,EAAE,SAAS,QAAQ,KAAK,SAAU,WAAW,2DAA2D;AAAA,EAAA,IAEhHJ,EAAwB,QAAQ,IAChCT,EAAA,MAAKxB,GAALW,CAAA,EAAA,KAAA,IAAA;AAEJ;AAEMF,IAAsB,iBAAG;;AAC7B,QAAMwB,KAA4CrC,IAAA,KAAK,eAAL,gBAAAA,EAAiB,eAAe;AAClF,MAAI,CAACqC,EAAyB;AAE1B,QAAA,EAAE,OAAAG,EAAM,IAAI,MAAML;AAAA,IACvB;AAAA,IACAC,EAAe,gBAAgB,EAAC,aAAa;AAAA,MACxC,OAAO,KAAK,SAAU;AAAA,MACtB,OAAOC,EAAwB;AAAA,IAAA,GAC/B;AAAA,EAAA;AAGJ,EAAKG,OACED,IAAAN,EAAA,MAAA9B,CAAA,MAAA,QAAAoC,EAAsB,KAAK,YAAY;AAAA,IAC1C,MAAM,EAAE,SAAS,QAAQ,KAAK,SAAU,WAAW,yCAAyC;AAAA,EAAA,IAE9FF,EAAwB,QAAQ,IAChCT,EAAA,MAAKxB,GAALW,CAAA,EAAA,KAAA,IAAA;AAEJ;AAEMD,IAAW,iBAAG;;AAClB,QAAM4B,KAAuC1C,IAAA,KAAK,eAAL,gBAAAA,EAAiB,eAAe;AAC7E,MAAI,CAAC0C,EAAoB;AAErB,QAAA,EAAE,OAAAF,EAAM,IAAI,MAAML;AAAA,IACvB;AAAA,IACAC,EAAe,WAAW,EAAC,aAAa;AAAA,MACnC,OAAO,KAAK,SAAU;AAAA,MACtB,QAAQM,EAAmB;AAAA,IAAA,GAC3B;AAAA,EAAA;AAGJ,EAAKF,OACED,IAAAN,EAAA,MAAA9B,CAAA,MAAA,QAAAoC,EAAsB,KAAK,YAAY;AAAA,IAC1C,MAAM,EAAE,SAAS,QAAQ,KAAK,SAAU,WAAW,oCAAoC;AAAA,EAAA,IAEzFG,EAAmB,QAAQ,IAC3Bd,EAAA,MAAKxB,GAALW,CAAA,EAAA,KAAA,IAAA;AAEJ;AAEAA,IAAsB,WAAG;;AAEvB,GAAAf,IAAAiC,EAAA,MAAK/B,CAAmB,MAAxB,QAAAF,EAAwB,KAAK,KAAK,SAAU;AAC9C;AAEMgB,IAAkB,iBAAG;;AACzB,OAAK,yBAAyB;AAEhC,QAAM,EAAE,MAAAkB,GAAM,OAAAM,EAAM,IAAI,MAAMG;AAAA,IAC7BP,EAAe,kBAAkB;AAAA,MAC5B,OAAO,KAAK,SAAU;AAAA,IAAA,CACvB;AAAA,EAAA;AAGC,EAAA,CAACF,KAAQM,KACNxC,IAAAiC,EAAA,MAAA9B,CAAA,MAAA,QAAAH,EAAsB,KAAK,UAAU;AAAA,IACxC,MAAM,EAAE,SAAS,2CAA0CwC,KAAA,gBAAAA,EAAO,SAAQ;AAAA,EAAA,KAIvE,KAAA,yBAAyB,cAAc,KAAK,SAAU,gBAAgB;AAAA,cAAmB,KAAK,UAAUN,GAAM,MAAM,CAAC;AAE9H;AAyBAjB,IAAoB,SAAC2B,GAAmC;AAC/C,SAAAb;AAAA;AAAA,yDAE8Ca,EAAQ,eAAe,aAAa,QAAQ;AAAA,YACzFA,EAAQ,eAAe,eAAe,gBAAgB;AAAA;AAAA,gBAElDA,EAAQ,WAAW;AAAA,UACzBZ;AAAA,IAAKY,EAAQ;AAAA,IACb,MAAMb;AAAA;AAAA,gBAEAC;AAAA,MAAKY,EAAQ;AAAA,MACb,MAAMb;AAAA;AAAA;AAAA;AAAA,6BAIOH,QAAKxB,GAAkBY,CAAA,CAAA;AAAA;AAAA,IAAA,CAClC;AAAA,gBACFgB;AAAA,MAAKC,QAAK3B,CAAL,EAAA,KAAA,IAAA,KAAoB2B,QAAK1B,CAAL,EAAA,KAAA,IAAA,KAAqC0B,QAAKzB,CAAL,EAAA,KAAA,IAAA;AAAA,MAC9D,MAAMuB;AAAA;AAAA;AAAA;AAAA;AAAA,6BAKOH,QAAKxB,GAAaO,CAAA,CAAA;AAAA;AAAA,IAAA,CAC7B;AAAA;AAAA,gBAEFqB;AAAA,MAAK,KAAK;AAAA,MACV,MAAMD;AAAA;AAAA,6BAEO,KAAK,sBAAsB;AAAA;AAAA,IAAA,CAEvC;AAAA;AAAA;AAAA,EAAA,CAEL;AAAA;AAAA,UAEFC;AAAA,IAAK,CAACY,EAAQ,gBAAgB,CAACX,QAAKxB,CAAL,EAAA,KAAA,IAAA;AAAA,IAC/B,MAAMsB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAOSH,QAAKxB,GAAgBM,CAAA,CAAA;AAAA;AAAA;AAAA,EAAA,CAElC;AAAA;AAAA;AAAA;AAIV;AAEAQ,IAAyB,WAAG;AACnB,SAAAa;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,2BAmBgBH,QAAKxB,GAAsBQ,CAAA,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMpD;AAEAO,IAAyB,WAAG;AACnB,SAAAY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAecH,QAAKxB,GAAsBS,CAAA,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMlD;AAEAO,IAAiB,WAAG;AACX,SAAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,yBAkBcH,QAAKxB,GAAWU,CAAA,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAMvC;AAEAO,IAAsB,SAACuB,GAAmC;AACjD,SAAAb;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,YAOC,OAAO,QAAQa,EAAQ,QAAQ,EAAE,IAAI,CAAC,CAACC,GAAKC,CAAK,MACjDf;AAAA,gCACoBc,CAAG;AAAA,gCACHC,CAAK;AAAA,6BACR,CAAC;AAAA;AAAA;AAAA;AAI5B;AAvVWvB,EAyVJ,SAAS;AAAA,EACdwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AA0BF;AA9WQC,EAAA;AAAA,EADPC,EAAM;AAAA,GALI1B,EAMH,WAAA,YAAA,CAAA;AAGAyB,EAAA;AAAA,EADPC,EAAM;AAAA,GARI1B,EASH,WAAA,yBAAA,CAAA;AAGAyB,EAAA;AAAA,EADPC,EAAM;AAAA,GAXI1B,EAYH,WAAA,0BAAA,CAAA;AAZGA,IAANyB,EAAA;AAAA,EADNE,GAAc5B,EAAW;AAAA,GACbC,CAAA;;ACPN,MAAM4B,WACHC,EAEV;AAAA,EAUE,YAAYC,GAAgC;AAC1C,UAAMA,GAAMC,CAAe;AAV7B,IAAA5B,EAAA,MAAA6B;AAAQ,IAAA5B,EAAA,MAAA4B,GAAA,IAAIC,EAAqD,MAAS,IAEjE,KAAA,OAAOvB,EAAA,MAAKsB,GAAM,aAAa,GACxC,KAAS,QAAQtB,EAAA,MAAKsB,GAAM,iBAAiB,CAACrB,MAASA,KAAA,gBAAAA,EAAM,KAAK,GAClE,KAAS,OAAOD,EAAA,MAAKsB,GAAM,iBAAiB,CAACrB,MAASA,KAAA,gBAAAA,EAAM,WAAW,GAOhE,KAAA,eAAerC,GAAuC,IAAI,GAE/D,KAAK,iBAAiByD,GACjB,KAAA,SAAS,IAAIG,EAAyBJ,CAAI,GAE/C,KAAK,OAAO,UAAU;AAAA,MACpB;AAAA,QACE,MAAM;AAAA,QACN,WAAW9B;AAAA,QACX,OAAO,CAACmC,GAAYC,MAAS;AACrB,gBAAAC,IAAQD,EAAK,MAAM,OAAO;AAChC,eAAK,KAAKC,CAAK;AAAA,QACjB;AAAA,MACF;AAAA,IAAA,CACD;AAAA,EACH;AAAA,EAEA,MAAM,KAAKA,GAAe;AAEpB,UAAA,EAAE,MAAA1B,EAAK,IAAI,MAAMC;AAAA,MACtB;AAAA,MACAC,EAAe,WAAW,EAAC,OAAAwB,GAAM;AAAA,IAAA;AAGhC,IAAI1B,KACGD,EAAA,MAAAsB,GAAM,OAAOrB,CAAI;AAAA,EAE1B;AAAA,EAEA,UAAU;AACD,WAAAD,EAAA,MAAKsB,GAAM;EACpB;AAAA,EAEA,gBAAwB;AACf,WAAAtD;AAAA,EACT;AAAA,EAEA,UAAU;;AACD,YAAAD,IAAAiC,EAAA,MAAKsB,GAAM,SAAA,MAAX,gBAAAvD,EAAuB;AAAA,EAChC;AAAA,EAEA,UAAU;AACR,IAAAiC,EAAA,MAAKsB,GAAM;EACb;AACF;AAvDEA,IAAA;"}